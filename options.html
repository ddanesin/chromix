<html>
<head><title>My Test Extension Options</title>
<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="option_style.css" />
</head>
<script type="text/javascript">

// Restores select box state to saved value from localStorage.

$(document).ready(function(){
	var options = localStorage.getItem("options");
	if( options ){
		var notification = JSON.parse(options).notification;
		if( notification == "On" ){
			$("div[name=notification]").removeClass("selected");
			$("#notification_on").addClass("selected");
		}else{
			$("div[name=notification]").removeClass("selected");
			$("#notification_off").addClass("selected");
		}
	}
	$("div[name=notification]").click( function() {
		if( !$(this).hasClass("selected") ){
			var obj = $(this);
			if( obj.text() == "On" ){
				if(window.webkitNotifications.requestPermission(function() {
    					if(window.webkitNotifications.checkPermission() == 0) {
							changeOption("notification","On");
							$("div[name=notification]").removeClass("selected");
							obj.addClass("selected");
    					} else {
    					}
				}));
			}else{
				changeOption("notification","Off");
				$("div[name=notification]").removeClass("selected");
				$(this).addClass("selected");
			}
		}	
	});
});


function addOption(key,value){
	var option_data = JSON.parse(localStorage.getItem("options"));
	if( !option_data ){
		initOption(key,value);
		option_data = JSON.parse(localStorage.getItem("options"));
	}else{
		option_data[key] = value;
	}
	localStorage.setItem("options",JSON.stringify(option_data));
}


function initOption( key , value){
	var data = {};
	data[key] = value;
	localStorage.setItem("options",JSON.stringify(data));
}

function changeOption(key,new_value){
	var option_data = JSON.parse(localStorage.getItem("options"));
	if( !option_data ){
		initOption(key,new_value);
		return;
	}
	
	for( var index in option_data ){
		if( key == index ){
			option_data[index] = new_value;
		}
	}
	localStorage.setItem("options",JSON.stringify(option_data));
}

</script>

<body>
<div class="option_menu">
<div id="option_header">
Chromix Options
</div>
<table class="options">
<tr>
<td class="item">DesktopNotification:</td>
<td class="value">
	<ul>
		<li><div id="notification_on" class="radio left" name="notification"/><a href=#>On</a></li>
		<li><div id="notification_off" class="radio selected right" name="notification"/><a href=#>Off</a></li>
	</ul>
</td>
</tr>
</table>
</div>
</body>
</html>
