<html>
<head><title>My Test Extension Options</title>
<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="option_style.css" />
</head>
<script type="text/javascript">

// Restores select box state to saved value from localStorage.

$(document).ready(function(){
	$("#refreshrate_option").hover(function(){
		if( $("#refreshrate_ul").css('display') == "none" ){
			$("#refreshrate_ul").slideDown("normal");
		}else{
			$("#refreshrate_ul").slideUp("normal");
		}
	});
	$("#displaytime_option").hover(function(){
		if( $("#displaytime_ul").css('display') == "none" ){
			$("#displaytime_ul").slideDown("normal");
		}else{
			$("#displaytime_ul").slideUp("normal");
		}
	});
	$("div.select_item").click(function(){
		var name = $(this).attr("name");
		var value = parseInt($(this).text());
		addOption(name,value);
		if(name == "refreshrate"){
			$("#refreshrate_title").text(value);
			$("#refreshrate_ul div").removeClass("item_selected");
			$(this).addClass("item_selected");
		}else if(name == "displaytime"){
			$("#displaytime_title").text(value);
			$("#displaytime_ul div").removeClass("item_selected");
			$(this).addClass("item_selected");
		}
	});
	var options = localStorage.getItem("options");
	if( options ){
		var option = JSON.parse(options);
		var notification = option.notification;
		var refreshrate = option.refreshrate;
		var displaytime = option.displaytime;
		if( notification == "On" ){
			$("div[name=notification]").removeClass("selected");
			$("#notification_on").addClass("selected");
		}else{
			$("div[name=notification]").removeClass("selected");
			$("#notification_off").addClass("selected");
		}
		if( refreshrate ){
			$("#refreshrate_title").text(refreshrate);
		}
		if( displaytime ){
			$("#displaytime_title").text(displaytime);
		}
		
	}
	$("div[name=notification]").click( function() {
		if( !$(this).hasClass("selected") ){
			var obj = $(this);
			if( obj.text() == "On" ){
				if(window.webkitNotifications.requestPermission(function() {
    					if(window.webkitNotifications.checkPermission() == 0) {
							changeOption("notification","On");
							$("div[name=notification]").removeClass("selected");
							obj.addClass("selected");
    					} else {
    					}
				}));
			}else{
				changeOption("notification","Off");
				$("div[name=notification]").removeClass("selected");
				$(this).addClass("selected");
			}
		}	
	});
});


function addOption(key,value){
	var option_data = JSON.parse(localStorage.getItem("options"));
	if( !option_data ){
		initOption(key,value);
		option_data = JSON.parse(localStorage.getItem("options"));
	}else{
		option_data[key] = value;
	}
	localStorage.setItem("options",JSON.stringify(option_data));
}


function initOption( key , value){
	var data = {};
	data[key] = value;
	localStorage.setItem("options",JSON.stringify(data));
}

function changeOption(key,new_value){
	var option_data = JSON.parse(localStorage.getItem("options"));
	if( !option_data ){
		initOption(key,new_value);
		return;
	}
	
	for( var index in option_data ){
		if( key == index ){
			option_data[index] = new_value;
		}
	}
	localStorage.setItem("options",JSON.stringify(option_data));
}


</script>

<body>
<div class="option_menu">
<div id="option_header">
Chromix Options
</div>
<table class="options">
<tr>
<td class="item">DesktopNotification:</td>
<td class="value">
	<ul id="notification_flag">
		<li><div id="notification_on" class="radio left" name="notification"/><a href=#>On</a></li>
		<li><div id="notification_off" class="radio selected right" name="notification"/><a href=#>Off</a></li>
	</ul>
</td>
</tr>
<tr>
<td class="item">Background RefreshRate(sec):</td>
<td class="value select">
	<div id="refreshrate_option">
	<div id="refreshrate_title" class="box_title">Please Select RefreshRate</div>
	<ul id="refreshrate_ul" class="dropdown" style="display:none">
		<li><div class="select_item" name="refreshrate"/>10</div></li>
		<li><div class="select_item" name="refreshrate"/>20</div></li>
		<li><div class="select_item" name="refreshrate"/>30</div></li>
		<li><div class="select_item" name="refreshrate"/>60</div></li>
		<li><div class="select_item" name="refreshrate"/>300</div></li>
	</ul>
	</div>
</td>
</tr>
<tr>
<td class="item">Notification DisplayTime(sec):</td>
<td class="value select">
	<div id="displaytime_option">
	<div id="displaytime_title" class="box_title" >Please Select DisplayTime</div>
	<ul id="displaytime_ul" class="dropdown" style="display:none">
		<li><div class="select_item" name="displaytime"/>10</div></li>
		<li><div class="select_item" name="displaytime"/>20</div></li>
		<li><div class="select_item" name="displaytime"/>30</div></li>
		<li><div class="select_item" name="displaytime"/>60</div></li>
		<li><div class="select_item" name="displaytime"/>300</div></li>
	</ul>
	</div>
</td>
</tr>
</table>
</div>
</body>
</html>
