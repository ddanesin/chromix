<html>
<head>
<!-- Theme specific CSS files are loaded later by the ThemeManager -->
<title>Chromix</title>
<style type="text/css" src="style.css"></style>
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="zabbix-api.js"></script>
<script type="text/javascript">
(function ($) {
  jQuery.expr[':'].Contains = function(a,i,m){
      return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
  };
  function filterList(header, list) {
    var form = $("<form>").attr({"class":"filterform","action":"#"}),
        input = $("<input>").attr({"class":"filterinput","type":"text"});
    $(form).append(input).appendTo(header);
    $(input)
      .change( function () {
        var filter = $(this).val();
        if(filter) {
		  $matches = $(list).find('a:Contains(' + filter + ')').parent();
		  $('li', list).not($matches).slideUp();
		  $matches.slideDown();
        } else {
          $(list).find("li").slideDown();
        }
        return false;
      })
    .keyup( function () {
        $(this).change();
    });
  }
  $(function () {
    filterList($("#form"), $("#list"));
  });
}(jQuery));
</script>
<script type="text/javascript">

function displayLoginBox(){
	clearMsg();
	if( $("#login").css('display') == "none" ){
		$("#login").slideDown("slow");
		$("#add").text("Close Box");
	}else{
		$("#login").slideUp("slow");
		$("#add").text("Add Zabbix");
	}
}

function Login(){
	var url = $("#url").val();
	var username = $("#username").val();
	var password = $("#password").val();

	var auth = getAuth(url,username,password);
	if( auth.result != null ){
		if( auth.result == "Connection Error!" ){
			outputError(auth.result);
		}else{
			var data = {
			token:auth.result,
			checktime:parseInt((new Date)/1000)
			};
			var json_data = JSON.stringify(data);
			localStorage.setItem(url,json_data);
			location.reload();
			outputMsg("Login Success");
		}
	}else{
		outputError("Login Failure!");
	}
}


$(document).ready(function(){
	getTab();
	$(function() {
	$("input").css('color', '#999');
	var input_val = [];
	$("input").each(function() {
		input_val.push($(this).val());
	});
	$("input").focus(function() {
		var chk_num = $("input").index(this);
		var chk_val = $("input").eq(chk_num).val();
		if(chk_val == input_val[chk_num]) {
			var def_val = $(this).val();
			$(this).val('');
			$(this).css('color', '#333');
			$(this).blur(function() {
				if($(this).val() == '') {
					$(this).val(def_val);
					$(this).css('color', '#999');
				}
			});
		}
	});
});
	
});

selectedTabView(sessionStorage.getItem("selected"));

//getTab();

</script>
</head>
<body>
<div align="right">
<a href="#" id="add" onclick="displayLoginBox()">Add Zabbix</a>
</div>
<div id="message" style="display:none" ></div>
<div id="error" style="display:none"></div>
<div id="login" style="display:none">
<form>
<table id="loginform">
  <tr>
    <td align="right">URL:</td>
    <td><input type="text" id="url" value="hostname/zabbix"></td>
  </tr><tr>
    <td align="right">ID:</td>
    <td><input type="text" id="username" value="admin"></td>
  </tr><tr>
    <td align="right">Password:</td>
    <td><input type="password" id="password"></td>
  </tr>
  <tr>
  <td></td>
  <td align="right"><div id="buttom"><a href="#" onclick="Login()">login</a></div></td>
  </tr>
</table>
</form>
</div>

<div id="tab"></div>
<div id="datatable"></div>
</body>
</html>
